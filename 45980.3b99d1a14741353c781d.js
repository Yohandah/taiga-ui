"use strict";(self.webpackChunk_taiga_ui_components=self.webpackChunk_taiga_ui_components||[]).push([[45980],{45980:(Ai,we,ne)=>{ne.r(we),ne.d(we,{Placeholder:()=>ln,default:()=>ln});var an=ne(40256),g=ne(62463),S=ne(35917),cn=ne(38480);const $="undefined"!=typeof navigator?navigator:null,ve="undefined"!=typeof document?document:null,K=$&&$.userAgent||"",Oe=/Edge\/(\d+)/.exec(K),et=/MSIE \d/.exec(K),Me=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(K),T=!!(et||Me||Oe),W=et?document.documentMode:Me?+Me[1]:Oe?+Oe[1]:0,I=!T&&/gecko\/(\d+)/i.test(K);I&&/Firefox\/(\d+)/.exec(K);const xe=!T&&/Chrome\/(\d+)/.exec(K),O=!!xe,dn=xe?+xe[1]:0,x=!T&&!!$&&/Apple Computer/.test($.vendor),ie=x&&(/Mobile\/\w+/.test(K)||!!$&&$.maxTouchPoints>2),V=ie||!!$&&/Mac/.test($.platform),z=/Android \d/.test(K),ge=!!ve&&"webkitFontSmoothing"in ve.documentElement.style,fn=ge?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,E=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},hn=/^(img|br|input|textarea|hr)$/i;function nt(t,e,n,i,s){for(;;){if(t==n&&e==i)return!0;if(e==(s<0?0:F(t))){let o=t.parentNode;if(!o||1!=o.nodeType||pn(t)||hn.test(t.nodeName)||"false"==t.contentEditable)return!1;e=E(t)+(s<0?0:1),t=o}else{if(1!=t.nodeType)return!1;if("false"==(t=t.childNodes[e+(s<0?-1:0)]).contentEditable)return!1;e=s<0?F(t):0}}}function F(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function pn(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Te=function(t){let e=t.isCollapsed;return e&&O&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function se(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const ue=function(t){t&&(this.nodeName=t)};function Nt(t){return t.editable?t.hasFocus():function(t){let e=t.domSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function j(t,e=!1){let n=t.state.selection;if(function(t,e){if(e instanceof g.qv){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Tt(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Tt(t)}(t,n),Nt(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&O){let i=t.domSelection(),s=t.domObserver.currentSelection;if(i.anchorNode&&s.anchorNode&&function(t,e,n,i){return n&&(nt(t,e,n,i,-1)||nt(t,e,n,i,1))}(i.anchorNode,i.anchorOffset,s.anchorNode,s.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function(t){let e=t.domSelection(),n=document.createRange(),i=t.cursorWrapper.dom,s="IMG"==i.nodeName;s?n.setEnd(i.parentNode,E(i)+1):n.setEnd(i,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!s&&!t.state.selection.visible&&T&&W<=11&&(i.disabled=!0,i.disabled=!1)}(t);else{let o,r,{anchor:i,head:s}=n;Ot&&!(n instanceof g.Bs)&&(n.$from.parent.inlineContent||(o=Mt(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(r=Mt(t,n.to))),t.docView.setSelection(i,s,t.root,e),Ot&&(o&&xt(o),r&&xt(r)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelection(),i=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=i||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Nt(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}ue.prototype=Object.create(null),new ue;const Ot=x||O&&dn<63;function Mt(t,e){let{node:n,offset:i}=t.docView.domFromPos(e,0),s=i<n.childNodes.length?n.childNodes[i]:null,o=i?n.childNodes[i-1]:null;if(x&&s&&"false"==s.contentEditable)return Re(s);if(!(s&&"false"!=s.contentEditable||o&&"false"!=o.contentEditable)){if(s)return Re(s);if(o)return Re(o)}}function Re(t){return t.contentEditable="true",x&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function xt(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Tt(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Ie(t,e,n,i){return t.someProp("createSelectionBetween",s=>s(t,e,n))||g.Bs.between(e,n,i)}function ze(t,e){let{$anchor:n,$head:i}=t.selection,s=e>0?n.max(i):n.min(i),o=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return o&&g.Y1.findFrom(o,e)}function Z(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Pt(t,e,n){let i=t.state.selection;if(!(i instanceof g.Bs)){if(i instanceof g.qv&&i.node.isInline)return Z(t,new g.Bs(e>0?i.$to:i.$from));{let s=ze(t.state,e);return!!s&&Z(t,s)}}if(!i.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){let s=ze(t.state,e);return!!(s&&s instanceof g.qv)&&Z(t,s)}if(!(V&&n.indexOf("m")>-1)){let r,s=i.$head,o=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!o||o.isText)return!1;let l=e<0?s.pos-o.nodeSize:s.pos;return!!(o.isAtom||(r=t.docView.descAt(l))&&!r.contentDOM)&&(g.qv.isSelectable(o)?Z(t,new g.qv(e<0?t.state.doc.resolve(s.pos-o.nodeSize):s)):!!ge&&Z(t,new g.Bs(t.state.doc.resolve(e<0?l:l+o.nodeSize))))}}function be(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function pe(t){let e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function Fe(t){let e=t.domSelection(),n=e.focusNode,i=e.focusOffset;if(!n)return;let s,o,r=!1;for(I&&1==n.nodeType&&i<be(n)&&pe(n.childNodes[i])&&(r=!0);;)if(i>0){if(1!=n.nodeType)break;{let l=n.childNodes[i-1];if(pe(l))s=n,o=--i;else{if(3!=l.nodeType)break;n=l,i=n.nodeValue.length}}}else{if(At(n))break;{let l=n.previousSibling;for(;l&&pe(l);)s=n.parentNode,o=E(l),l=l.previousSibling;if(l)n=l,i=be(n);else{if(n=n.parentNode,n==t.dom)break;i=0}}}r?qe(t,e,n,i):s&&qe(t,e,s,o)}function Le(t){let e=t.domSelection(),n=e.focusNode,i=e.focusOffset;if(!n)return;let o,r,s=be(n);for(;;)if(i<s){if(1!=n.nodeType)break;if(!pe(n.childNodes[i]))break;o=n,r=++i}else{if(At(n))break;{let l=n.nextSibling;for(;l&&pe(l);)o=l.parentNode,r=E(l)+1,l=l.nextSibling;if(l)n=l,i=0,s=be(n);else{if(n=n.parentNode,n==t.dom)break;i=s=0}}}o&&qe(t,e,o,r)}function At(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function qe(t,e,n,i){if(Te(e)){let o=document.createRange();o.setEnd(n,i),o.setStart(n,i),e.removeAllRanges(),e.addRange(o)}else e.extend&&e.extend(n,i);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&j(t)},50)}function Bt(t,e,n){let i=t.state.selection;if(i instanceof g.Bs&&!i.empty||n.indexOf("s")>-1||V&&n.indexOf("m")>-1)return!1;let{$from:s,$to:o}=i;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let r=ze(t.state,e);if(r&&r instanceof g.qv)return Z(t,r)}if(!s.parent.inlineContent){let r=e<0?s:o,l=i instanceof g.C1?g.Y1.near(r,e):g.Y1.findFrom(r,e);return!!l&&Z(t,l)}return!1}function Rt(t,e){if(!(t.state.selection instanceof g.Bs))return!0;let{$head:n,$anchor:i,empty:s}=t.state.selection;if(!n.sameParent(i))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let r=t.state.tr;return e<0?r.delete(n.pos-o.nodeSize,n.pos):r.delete(n.pos,n.pos+o.nodeSize),t.dispatch(r),!0}return!1}function It(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function zt(t,e){let n=[],{content:i,openStart:s,openEnd:o}=e;for(;s>1&&o>1&&1==i.childCount&&1==i.firstChild.childCount;){s--,o--;let f=i.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),i=f.content}let r=t.someProp("clipboardSerializer")||S.PW.fromSchema(t.state.schema),l=Yt(),a=l.createElement("div");a.appendChild(r.serializeFragment(i,{document:l}));let d,c=a.firstChild,u=0;for(;c&&1==c.nodeType&&(d=Wt[c.nodeName.toLowerCase()]);){for(let f=d.length-1;f>=0;f--){let p=l.createElement(d[f]);for(;a.firstChild;)p.appendChild(a.firstChild);a.appendChild(p),u++}c=a.firstChild}return c&&1==c.nodeType&&c.setAttribute("data-pm-slice",`${s} ${o}${u?` -${u}`:""} ${JSON.stringify(n)}`),{dom:a,text:t.someProp("clipboardTextSerializer",f=>f(e))||e.content.textBetween(0,e.content.size,"\n\n")}}function Ft(t,e,n,i,s){let r,l,o=s.parent.type.spec.code;if(!n&&!e)return null;let a=e&&(i||o||!n);if(a){if(t.someProp("transformPastedText",h=>{e=h(e,o||i)}),o)return e?new S.p2(S.HY.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):S.p2.empty;let u=t.someProp("clipboardTextParser",h=>h(e,s,i));if(u)l=u;else{let h=s.marks(),{schema:f}=t.state,p=S.PW.fromSchema(f);r=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let b=r.appendChild(document.createElement("p"));m&&b.appendChild(p.serializeNode(f.text(m,h)))})}}else t.someProp("transformPastedHTML",u=>{n=u(n)}),r=function(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let s,n=Yt().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(t);if((s=i&&Wt[i[1].toLowerCase()])&&(t=s.map(o=>"<"+o+">").join("")+t+s.map(o=>"</"+o+">").reverse().join("")),n.innerHTML=t,s)for(let o=0;o<s.length;o++)n=n.querySelector(s[o])||n;return n}(n),ge&&function(t){let e=t.querySelectorAll(O?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let i=e[n];1==i.childNodes.length&&"\xa0"==i.textContent&&i.parentNode&&i.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),i)}}(r);let c=r&&r.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let u=+d[3];u>0&&r.firstChild;u--)r=r.firstChild;if(l||(l=(t.someProp("clipboardParser")||t.someProp("domParser")||S.aw.fromSchema(t.state.schema)).parseSlice(r,{preserveWhitespace:!(!a&&!d),context:s,ruleFromNode:h=>"BR"!=h.nodeName||h.nextSibling||!h.parentNode||Xn.test(h.parentNode.nodeName)?null:{ignore:!0}})),d)l=function(t,e){if(!t.size)return t;let i,n=t.content.firstChild.type.schema;try{i=JSON.parse(e)}catch(l){return t}let{content:s,openStart:o,openEnd:r}=t;for(let l=i.length-2;l>=0;l-=2){let a=n.nodes[i[l]];if(!a||a.hasRequiredAttrs())break;s=S.HY.from(a.create(i[l+1],s)),o++,r++}return new S.p2(s,o,r)}(Kt(l,+d[1],+d[2]),d[4]);else if(l=S.p2.maxOpen(function(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let o,s=e.node(n).contentMatchAt(e.index(n)),r=[];if(t.forEach(l=>{if(!r)return;let c,a=s.findWrapping(l.type);if(!a)return r=null;if(c=r.length&&o.length&&qt(a,o,l,r[r.length-1],0))r[r.length-1]=c;else{r.length&&(r[r.length-1]=$t(r[r.length-1],o.length));let d=Lt(l,a);r.push(d),s=s.matchType(d.type),o=a}}),r)return S.HY.from(r)}return t}(l.content,s),!0),l.openStart||l.openEnd){let u=0,h=0;for(let f=l.content.firstChild;u<l.openStart&&!f.type.spec.isolating;u++,f=f.firstChild);for(let f=l.content.lastChild;h<l.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);l=Kt(l,u,h)}return t.someProp("transformPasted",u=>{l=u(l)}),l}const Xn=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Lt(t,e,n=0){for(let i=e.length-1;i>=n;i--)t=e[i].create(null,S.HY.from(t));return t}function qt(t,e,n,i,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let o=qt(t,e,n,i.lastChild,s+1);if(o)return i.copy(i.content.replaceChild(i.childCount-1,o));if(i.contentMatchAt(i.childCount).matchType(s==t.length-1?n.type:t[s+1]))return i.copy(i.content.append(S.HY.from(Lt(n,t,s+1))))}}function $t(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,$t(t.lastChild,e-1)),i=t.contentMatchAt(t.childCount).fillBefore(S.HY.empty,!0);return t.copy(n.append(i))}function $e(t,e,n,i,s,o){let r=e<0?t.firstChild:t.lastChild,l=r.content;return s<i-1&&(l=$e(l,e,n,i,s+1,o)),s>=n&&(l=e<0?r.contentMatchAt(0).fillBefore(l,t.childCount>1||o<=s).append(l):l.append(r.contentMatchAt(r.childCount).fillBefore(S.HY.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,r.copy(l))}function Kt(t,e,n){return e<t.openStart&&(t=new S.p2($e(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new S.p2($e(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const Wt={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ht=null;function Yt(){return Ht||(Ht=document.implementation.createHTMLDocument("title"))}const k={};let M={};function w(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function De(t){return{left:t.clientX,top:t.clientY}}function He(t,e,n,i,s){if(-1==i)return!1;let o=t.state.doc.resolve(i);for(let r=o.depth+1;r>0;r--)if(t.someProp(e,l=>r>o.depth?l(t,n,o.nodeAfter,o.before(r),s,!0):l(t,n,o.node(r),o.before(r),s,!1)))return!0;return!1}function le(t,e,n){t.focused||t.focus();let i=t.state.tr.setSelection(e);"pointer"==n&&i.setMeta("pointer",!0),t.dispatch(i)}function ri(t,e,n,i){return He(t,"handleDoubleClickOn",e,n,i)||t.someProp("handleDoubleClick",s=>s(t,e,i))}function li(t,e,n,i){return He(t,"handleTripleClickOn",e,n,i)||t.someProp("handleTripleClick",s=>s(t,e,i))||function(t,e,n){if(0!=n.button)return!1;let i=t.state.doc;if(-1==e)return!!i.inlineContent&&(le(t,g.Bs.create(i,0,i.content.size),"pointer"),!0);let s=i.resolve(e);for(let o=s.depth+1;o>0;o--){let r=o>s.depth?s.nodeAfter:s.node(o),l=s.before(o);if(r.inlineContent)le(t,g.Bs.create(i,l+1,l+1+r.content.size),"pointer");else{if(!g.qv.isSelectable(r))continue;le(t,g.qv.create(i,l),"pointer")}return!0}}(t,n,i)}function Ye(t){return Se(t)}M.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!Ut(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!z||!O||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!ie||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",i=>i(t,n))||function(t,e){let n=e.keyCode,i=function(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);return 8==n||V&&72==n&&"c"==i?Rt(t,-1)||Fe(t):46==n||V&&68==n&&"c"==i?Rt(t,1)||Le(t):13==n||27==n||(37==n||V&&66==n&&"c"==i?Pt(t,-1,i)||Fe(t):39==n||V&&70==n&&"c"==i?Pt(t,1,i)||Le(t):38==n||V&&80==n&&"c"==i?Bt(t,-1,i)||Fe(t):40==n||V&&78==n&&"c"==i?function(t){if(!x||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelection();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let i=e.firstChild;It(t,i,"true"),setTimeout(()=>It(t,i,"false"),20)}return!1}(t)||Bt(t,1,i)||Le(t):i==(V?"m":"c")&&(66==n||73==n||89==n||90==n))}(t,n)?n.preventDefault():w(t,"key");else{let i=Date.now();t.input.lastIOSEnter=i,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==i&&(t.someProp("handleKeyDown",s=>s(t,se(13,"Enter"))),t.input.lastIOSEnter=0)},200)}},M.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},M.keypress=(t,e)=>{let n=e;if(Ut(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||V&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n)))return void n.preventDefault();let i=t.state.selection;if(!(i instanceof g.Bs&&i.$from.sameParent(i.$to))){let s=String.fromCharCode(n.charCode);t.someProp("handleTextInput",o=>o(t,i.$from.pos,i.$to.pos,s))||t.dispatch(t.state.tr.insertText(s).scrollIntoView()),n.preventDefault()}};const jt=V?"metaKey":"ctrlKey";k.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let i=Ye(t),s=Date.now(),o="singleClick";s-t.input.lastClick.time<500&&function(t,e){let n=e.x-t.clientX,i=e.y-t.clientY;return n*n+i*i<100}(n,t.input.lastClick)&&!n[jt]&&("singleClick"==t.input.lastClick.type?o="doubleClick":"doubleClick"==t.input.lastClick.type&&(o="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:o};let r=t.posAtCoords(De(n));!r||("singleClick"==o?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new ci(t,r,n,!!i)):("doubleClick"==o?ri:li)(t,r.pos,r.inside,n)?n.preventDefault():w(t,"pointer"))};class ci{constructor(e,n,i,s){let o,r;if(this.view=e,this.pos=n,this.event=i,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!i[jt],this.allowDefault=i.shiftKey,n.inside>-1)o=e.state.doc.nodeAt(n.inside),r=n.inside;else{let d=e.state.doc.resolve(n.pos);o=d.parent,r=d.depth?d.before():0}const l=s?null:i.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a?a.dom:null;let{selection:c}=e.state;(0==i.button&&o.type.spec.draggable&&!1!==o.type.spec.selectable||c instanceof g.qv&&c.from<=r&&c.to>r)&&(this.mightDrag={node:o,pos:r,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!I||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),w(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>j(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(De(e))),this.allowDefault||!n?w(this.view,"pointer"):function(t,e,n,i,s){return He(t,"handleClickOn",e,n,i)||t.someProp("handleClick",o=>o(t,e,i))||(s?function(t,e){if(-1==e)return!1;let i,s,n=t.state.selection;n instanceof g.qv&&(i=n.node);let o=t.state.doc.resolve(e);for(let r=o.depth+1;r>0;r--){let l=r>o.depth?o.nodeAfter:o.node(r);if(g.qv.isSelectable(l)){s=i&&n.$from.depth>0&&r>=n.$from.depth&&o.before(n.$from.depth+1)==n.$from.pos?o.before(n.$from.depth):o.before(r);break}}return null!=s&&(le(t,g.qv.create(t.state.doc,s),"pointer"),!0)}(t,n):function(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),i=n.nodeAfter;return!!(i&&i.isAtom&&g.qv.isSelectable(i))&&(le(t,new g.qv(n),"pointer"),!0)}(t,n))}(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||x&&this.mightDrag&&!this.mightDrag.node.isAtom||O&&!(this.view.state.selection instanceof g.Bs)&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(le(this.view,g.Y1.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):w(this.view,"pointer")}move(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),w(this.view,"pointer"),0==e.buttons&&this.done()}}function Ut(t,e){return!!t.composing||!!(x&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}k.touchdown=t=>{Ye(t),w(t,"pointer")},k.contextmenu=t=>Ye(t);const di=z?5e3:-1;function Xt(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Se(t),e))}function Se(t,e=!1){if(!(z&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),function(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=function(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}(t),e||t.docView&&t.docView.dirty){let n=function(t,e=null){let n=t.domSelection(),i=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),o=s&&0==s.size,r=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(r<0)return null;let a,c,l=i.resolve(r);if(Te(n)){for(a=l;s&&!s.node;)s=s.parent;let d=s.node;if(s&&d.isAtom&&g.qv.isSelectable(d)&&s.parent&&(!d.isInline||!function(t,e,n){for(let i=0==e,s=e==F(t);i||s;){if(t==n)return!0;let o=E(t);if(!(t=t.parentNode))return!1;i=i&&0==o,s=s&&o==F(t)}}(n.focusNode,n.focusOffset,s.dom))){let u=s.posBefore;c=new g.qv(r==u?l:i.resolve(u))}}else{let d=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(d<0)return null;a=i.resolve(d)}return c||(c=Ie(t,a,l,"pointer"==e||t.state.selection.head<l.pos&&!o?1:-1)),c}(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}}M.compositionstart=M.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(i=>!1===i.type.spec.inclusive)))t.markCursor=t.state.storedMarks||n.marks(),Se(t,!0),t.markCursor=null;else if(Se(t),I&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let i=t.domSelection();for(let s=i.focusNode,o=i.focusOffset;s&&1==s.nodeType&&0!=o;){let r=o<0?s.lastChild:s.childNodes[o-1];if(!r)break;if(3==r.nodeType){i.collapse(r,r.nodeValue.length);break}s=r,o=-1}}t.input.composing=!0}Xt(t,di)},M.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,Xt(t,20))};const ae=T&&W<15||ie&&fn<604;function je(t,e,n,i){let s=Ft(t,e,n,t.input.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||S.p2.empty)))return!0;if(!s)return!1;let o=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(s),r=o?t.state.tr.replaceSelectionWith(o,t.input.shiftKey):t.state.tr.replaceSelection(s);return t.dispatch(r.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}k.copy=M.cut=(t,e)=>{let n=e,i=t.state.selection,s="cut"==n.type;if(i.empty)return;let o=ae?null:n.clipboardData,r=i.content(),{dom:l,text:a}=zt(t,r);o?(n.preventDefault(),o.clearData(),o.setData("text/html",l.innerHTML),o.setData("text/plain",a)):function(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),i.removeAllRanges(),i.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}(t,l),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},M.paste=(t,e)=>{let n=e;if(t.composing&&!z)return;let i=ae?null:n.clipboardData;i&&je(t,i.getData("text/plain"),i.getData("text/html"),n)?n.preventDefault():function(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,i=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{t.focus(),i.parentNode&&i.parentNode.removeChild(i),n?je(t,i.value,null,e):je(t,i.textContent,i.innerHTML,e)},50)}(t,n)};class mi{constructor(e,n){this.slice=e,this.move=n}}const _t=V?"altKey":"ctrlKey";k.dragstart=(t,e)=>{let n=e,i=t.input.mouseDown;if(i&&i.done(),!n.dataTransfer)return;let s=t.state.selection,o=s.empty?null:t.posAtCoords(De(n));if(!(o&&o.pos>=s.from&&o.pos<=(s instanceof g.qv?s.to-1:s.to)))if(i&&i.mightDrag)t.dispatch(t.state.tr.setSelection(g.qv.create(t.state.doc,i.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let c=t.docView.nearestDesc(n.target,!0);c&&c.node.type.spec.draggable&&c!=t.docView&&t.dispatch(t.state.tr.setSelection(g.qv.create(t.state.doc,c.posBefore)))}let r=t.state.selection.content(),{dom:l,text:a}=zt(t,r);n.dataTransfer.clearData(),n.dataTransfer.setData(ae?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",ae||n.dataTransfer.setData("text/plain",a),t.dragging=new mi(r,!n[_t])},k.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},M.dragover=M.dragenter=(t,e)=>e.preventDefault(),M.drop=(t,e)=>{let n=e,i=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let s=t.posAtCoords(De(n));if(!s)return;let o=t.state.doc.resolve(s.pos);if(!o)return;let r=i&&i.slice;r?t.someProp("transformPasted",p=>{r=p(r)}):r=Ft(t,n.dataTransfer.getData(ae?"Text":"text/plain"),ae?null:n.dataTransfer.getData("text/html"),!1,o);let l=!(!i||n[_t]);if(t.someProp("handleDrop",p=>p(t,n,r||S.p2.empty,l)))return void n.preventDefault();if(!r)return;n.preventDefault();let a=r?(0,cn.nj)(t.state.doc,o.pos,r):o.pos;null==a&&(a=o.pos);let c=t.state.tr;l&&c.deleteSelection();let d=c.mapping.map(a),u=0==r.openStart&&0==r.openEnd&&1==r.content.childCount,h=c.doc;if(u?c.replaceRangeWith(d,d,r.content.firstChild):c.replaceRange(d,d,r),c.doc.eq(h))return;let f=c.doc.resolve(d);if(u&&g.qv.isSelectable(r.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(r.content.firstChild))c.setSelection(new g.qv(f));else{let p=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((m,b,D,R)=>p=R),c.setSelection(Ie(t,f,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))},k.focus=t=>{t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelection())&&j(t)},20))},k.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},k.beforeinput=(t,e)=>{if(O&&z&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();let{domChangeCount:i}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=i||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",o=>o(t,se(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in M)k[t]=M[t];function me(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Ue{constructor(e,n){this.toDOM=e,this.spec=n||v,this.side=this.spec.side||0}map(e,n,i,s){let{pos:o,deleted:r}=e.mapResult(n.from+s,this.side<0?-1:1);return r?null:new P(o-i,o-i,this)}valid(){return!0}eq(e){return this==e||e instanceof Ue&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&me(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class U{constructor(e,n){this.attrs=e,this.spec=n||v}map(e,n,i,s){let o=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-i,r=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-i;return o>=r?null:new P(o,r,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof U&&me(this.attrs,e.attrs)&&me(this.spec,e.spec)}static is(e){return e.type instanceof U}destroy(){}}class Xe{constructor(e,n){this.attrs=e,this.spec=n||v}map(e,n,i,s){let o=e.mapResult(n.from+s,1);if(o.deleted)return null;let r=e.mapResult(n.to+s,-1);return r.deleted||r.pos<=o.pos?null:new P(o.pos-i,r.pos-i,this)}valid(e,n){let o,{index:i,offset:s}=e.content.findIndex(n.from);return s==n.from&&!(o=e.child(i)).isText&&s+o.nodeSize==n.to}eq(e){return this==e||e instanceof Xe&&me(this.attrs,e.attrs)&&me(this.spec,e.spec)}destroy(){}}class P{constructor(e,n,i){this.from=e,this.to=n,this.type=i}copy(e,n){return new P(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,i){return this.type.map(e,this,n,i)}static widget(e,n,i){return new P(e,e,new Ue(n,i))}static inline(e,n,i,s){return new P(e,n,new U(i,s))}static node(e,n,i,s){return new P(e,n,new Xe(i,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof U}}const ce=[],v={};class C{constructor(e,n){this.local=e.length?e:ce,this.children=n.length?n:ce}static create(e,n){return n.length?Ce(n,e,0,v):N}find(e,n,i){let s=[];return this.findInner(null==e?0:e,null==n?1e9:n,s,0,i),s}findInner(e,n,i,s,o){for(let r=0;r<this.local.length;r++){let l=this.local[r];l.from<=n&&l.to>=e&&(!o||o(l.spec))&&i.push(l.copy(l.from+s,l.to+s))}for(let r=0;r<this.children.length;r+=3)if(this.children[r]<n&&this.children[r+1]>e){let l=this.children[r]+1;this.children[r+2].findInner(e-l,n-l,i,s+l,o)}}map(e,n,i){return this==N||0==e.maps.length?this:this.mapInner(e,n,0,0,i||v)}mapInner(e,n,i,s,o){let r;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,i,s);a&&a.type.valid(n,a)?(r||(r=[])).push(a):o.onRemove&&o.onRemove(this.local[l].spec)}return this.children.length?function(t,e,n,i,s,o,r){let l=t.slice(),a=(d,u,h,f)=>{for(let p=0;p<l.length;p+=3){let b,m=l[p+1];if(m<0||d>m+o)continue;let D=l[p]+o;u>=D?l[p+1]=d<=D?-2:-1:h>=s&&(b=f-h-(u-d))&&(l[p]+=b,l[p+1]+=b)}};for(let d=0;d<n.maps.length;d++)n.maps[d].forEach(a);let c=!1;for(let d=0;d<l.length;d+=3)if(l[d+1]<0){if(-2==l[d+1]){c=!0,l[d+1]=-1;continue}let u=n.map(t[d]+o),h=u-s;if(h<0||h>=i.content.size){c=!0;continue}let p=n.map(t[d+1]+o,-1)-s,{index:m,offset:b}=i.content.findIndex(h),D=i.maybeChild(m);if(D&&b==h&&b+D.nodeSize==p){let R=l[d+2].mapInner(n,D,u+1,t[d]+o+1,r);R!=N?(l[d]=h,l[d+1]=p,l[d+2]=R):(l[d+1]=-2,c=!0)}else c=!0}if(c){let d=function(t,e,n,i,s,o,r){function l(a,c){for(let d=0;d<a.local.length;d++){let u=a.local[d].map(i,s,c);u?n.push(u):r.onRemove&&r.onRemove(a.local[d].spec)}for(let d=0;d<a.children.length;d+=3)l(a.children[d+2],a.children[d]+c+1)}for(let a=0;a<t.length;a+=3)-1==t[a+1]&&l(t[a+2],e[a]+o+1);return n}(l,t,e,n,s,o,r),u=Ce(d,i,0,r);e=u.local;for(let h=0;h<l.length;h+=3)l[h+1]<0&&(l.splice(h,3),h-=3);for(let h=0,f=0;h<u.children.length;h+=3){let p=u.children[h];for(;f<l.length&&l[f]<p;)f+=3;l.splice(f,0,u.children[h],u.children[h+1],u.children[h+2])}}return new C(e.sort(ee),l)}(this.children,r||[],e,n,i,s,o):r?new C(r.sort(ee),ce):N}add(e,n){return n.length?this==N?C.create(e,n):this.addInner(e,n,0):this}addInner(e,n,i){let s,o=0;e.forEach((l,a)=>{let d,c=a+i;if(d=Qt(n,l,c)){for(s||(s=this.children.slice());o<s.length&&s[o]<a;)o+=3;s[o]==a?s[o+2]=s[o+2].addInner(l,d,c+1):s.splice(o,0,a,a+l.nodeSize,Ce(d,l,c+1,v)),o+=3}});let r=Jt(o?Zt(n):n,-i);for(let l=0;l<r.length;l++)r[l].type.valid(e,r[l])||r.splice(l--,1);return new C(r.length?this.local.concat(r).sort(ee):this.local,s||this.children)}remove(e){return 0==e.length||this==N?this:this.removeInner(e,0)}removeInner(e,n){let i=this.children,s=this.local;for(let o=0;o<i.length;o+=3){let r,l=i[o]+n,a=i[o+1]+n;for(let u,d=0;d<e.length;d++)(u=e[d])&&u.from>l&&u.to<a&&(e[d]=null,(r||(r=[])).push(u));if(!r)continue;i==this.children&&(i=this.children.slice());let c=i[o+2].removeInner(r,l+1);c!=N?i[o+2]=c:(i.splice(o,3),o-=3)}if(s.length)for(let r,o=0;o<e.length;o++)if(r=e[o])for(let l=0;l<s.length;l++)s[l].eq(r,n)&&(s==this.local&&(s=this.local.slice()),s.splice(l--,1));return i==this.children&&s==this.local?this:s.length||i.length?new C(s,i):N}forChild(e,n){if(this==N)return this;if(n.isLeaf)return C.empty;let i,s;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(i=this.children[l+2]);break}let o=e+1,r=o+n.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<r&&a.to>o&&a.type instanceof U){let c=Math.max(o,a.from)-o,d=Math.min(r,a.to)-o;c<d&&(s||(s=[])).push(a.copy(c,d))}}if(s){let l=new C(s.sort(ee),ce);return i?new X([l,i]):l}return i||N}eq(e){if(this==e)return!0;if(!(e instanceof C)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Ge(this.localsInner(e))}localsInner(e){if(this==N)return ce;if(e.inlineContent||!this.local.some(U.is))return this.local;let n=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof U||n.push(this.local[i]);return n}}C.empty=new C([],[]),C.removeOverlap=Ge;const N=C.empty;class X{constructor(e){this.members=e}map(e,n){const i=this.members.map(s=>s.map(e,n,v));return X.from(i)}forChild(e,n){if(n.isLeaf)return C.empty;let i=[];for(let s=0;s<this.members.length;s++){let o=this.members[s].forChild(e,n);o!=N&&(o instanceof X?i=i.concat(o.members):i.push(o))}return X.from(i)}eq(e){if(!(e instanceof X)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,i=!0;for(let s=0;s<this.members.length;s++){let o=this.members[s].localsInner(e);if(o.length)if(n){i&&(n=n.slice(),i=!1);for(let r=0;r<o.length;r++)n.push(o[r])}else n=o}return n?Ge(i?n:n.sort(ee)):ce}static from(e){switch(e.length){case 0:return N;case 1:return e[0];default:return new X(e)}}}function Jt(t,e){if(!e||!t.length)return t;let n=[];for(let i=0;i<t.length;i++){let s=t[i];n.push(new P(s.from+e,s.to+e,s.type))}return n}function Qt(t,e,n){if(e.isLeaf)return null;let i=n+e.nodeSize,s=null;for(let r,o=0;o<t.length;o++)(r=t[o])&&r.from>n&&r.to<i&&((s||(s=[])).push(r),t[o]=null);return s}function Zt(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function Ce(t,e,n,i){let s=[],o=!1;e.forEach((l,a)=>{let c=Qt(t,l,a+n);if(c){o=!0;let d=Ce(c,l,n+a+1,i);d!=N&&s.push(a,a+l.nodeSize,d)}});let r=Jt(o?Zt(t):t,-n).sort(ee);for(let l=0;l<r.length;l++)r[l].type.valid(e,r[l])||(i.onRemove&&i.onRemove(r[l].spec),r.splice(l--,1));return r.length||s.length?new C(r,s):N}function ee(t,e){return t.from-e.from||t.to-e.to}function Ge(t){let e=t;for(let n=0;n<e.length-1;n++){let i=e[n];if(i.from!=i.to)for(let s=n+1;s<e.length;s++){let o=e[s];if(o.from!=i.from){o.from<i.to&&(e==t&&(e=t.slice()),e[n]=i.copy(i.from,o.from),wt(e,s,i.copy(o.from,i.to)));break}o.to!=i.to&&(e==t&&(e=t.slice()),e[s]=o.copy(o.from,i.to),wt(e,s+1,o.copy(i.to,o.to)))}}return e}function wt(t,e,n){for(;e<t.length&&ee(n,t[e])>0;)e++;t.splice(e,0,n)}const ln=an.Extension.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something \u2026",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new g.Sy({props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:i}=e,s=[];return n?(t.descendants((o,r)=>{const l=i>=r&&i<=r+o.nodeSize;if((l||!this.options.showOnlyCurrent)&&!o.isLeaf&&!o.childCount){const c=[this.options.emptyNodeClass];this.editor.isEmpty&&c.push(this.options.emptyEditorClass);const d=P.node(r,r+o.nodeSize,{class:c.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:o,pos:r,hasAnchor:l}):this.options.placeholder});s.push(d)}return this.options.includeChildren}),C.create(t,s)):null}}})]}})}}]);